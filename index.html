<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Happy Birthday My Love! ðŸ’–</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      text-align: center;
      background-color: #000;
    }

    #pinkboard {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 2;
      transition: opacity 1.5s ease;
    }

    #main-content {
      position: absolute;
      z-index: 3;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      opacity: 0;
      transition: opacity 1.5s ease;
      padding: 2rem;
    }

    #main-content.show {
      opacity: 1;
    }

    canvas#heart {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
    }

    .wrap {
      max-width: 90%;
      padding: 2rem;
      background: transparent;
      border-radius: 1.5rem;
      box-shadow: none;
      z-index: 3;
    }

    .type-wrap {
      font-size: 1.5rem;
      line-height: 2.2rem;
      color: white;
    }

    .slideshow {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      z-index: 4;
      display: none;
      justify-content: center;
      align-items: center;
    }

    .slideshow img {
      position: absolute;
      width: 80vw;
      height: 80vh;
      object-fit: contain;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    .slideshow img.active {
      opacity: 1;
    }

    .gallery {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 5;
      width: 100vw;
      height: 100vh;
      padding: 2rem;
      box-sizing: border-box;
      overflow-y: auto;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      gap: 1rem;
    }

    .gallery img {
      width: 30%;
      max-width: 300px;
      height: auto;
      border-radius: 10px;
    }

    .next-button {
      display: inline-block;
      padding: 12px 24px;
      font-size: 18px;
      font-family: 'Poppins', sans-serif;
      color: white;
      background-color: #ff69b4;
      text-decoration: none;
      border-radius: 30px;
      box-shadow: 0 4px 15px rgba(255,105,180,0.4);
      transition: background-color 0.3s, transform 0.2s;
      margin-bottom: 2rem;
    }

    .next-button:hover {
      background-color: #ff1493;
      transform: scale(1.05);
    }

    #typed {
      font-family: 'Poppins', sans-serif;
      font-size: 1.8rem;
      color: #fbeaff;
      text-align: center;
      text-shadow: 1px 1px 3px rgba(255, 182, 193, 0.6);
      letter-spacing: 1px;
      animation: fadeSlideIn 2s ease forwards;
      min-height: 3rem;
      line-height: 1.6;
      padding: 0 20px;
      max-width: 900px;
    }

    @keyframes fadeSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #toggle-music {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255,105,180,0.9);
      border: none;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      font-size: 20px;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
      z-index: 1000;
      transition: all 0.3s ease;
    }

    #toggle-music:hover {
      background: rgba(255,105,180,1);
      transform: scale(1.1);
    }

    .music-notification {
      position: fixed;
      bottom: 70px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      font-size: 14px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .music-notification.show {
      opacity: 1;
    }

    /* Swan background for final screen */
    .swan-background {
      background: linear-gradient(135deg, #e6f3ff 0%, #b3d9ff 50%, #99ccff 100%);
      position: relative;
      overflow: hidden;
    }

    .swan-background::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"><path d="M30,50 Q45,35 60,50 Q45,65 30,50" fill="white" opacity="0.4"/><path d="M60,50 Q65,45 70,50 Q65,55 60,50" fill="white" opacity="0.4"/></svg>'),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="80" height="80"><path d="M70,30 Q55,15 40,30 Q55,45 70,30" fill="white" opacity="0.3"/><path d="M40,30 Q35,25 30,30 Q35,35 40,30" fill="white" opacity="0.3"/></svg>');
      background-size: 150px 150px, 120px 120px;
      background-position: 10% 20%, 80% 70%;
      background-repeat: no-repeat;
      animation: floatSwans 30s infinite linear;
    }

    .swan-background::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(255,255,255,0.4) 2%, transparent 4%),
        radial-gradient(circle at 80% 20%, rgba(255,255,255,0.4) 2%, transparent 4%),
        radial-gradient(circle at 40% 40%, rgba(255,255,255,0.3) 1%, transparent 3%),
        radial-gradient(circle at 60% 60%, rgba(255,255,255,0.3) 1%, transparent 3%);
      animation: sparkle 4s infinite alternate;
    }

    @keyframes floatSwans {
      0% { transform: translateX(0px) rotate(0deg); }
      25% { transform: translateX(10px) rotate(1deg); }
      50% { transform: translateX(0px) rotate(0deg); }
      75% { transform: translateX(-10px) rotate(-1deg); }
      100% { transform: translateX(0px) rotate(0deg); }
    }

    @keyframes sparkle {
      0% { opacity: 0.3; }
      100% { opacity: 0.7; }
    }

    .gallery-content {
      position: relative;
      z-index: 2;
      background: rgba(255, 255, 255, 0.9);
      padding: 2rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin: 2rem;
    }

    .gallery-content h2 {
      color: #ff69b4;
      font-size: 2.5rem;
      margin-bottom: 1rem;
      font-family: 'Poppins', sans-serif;
    }

    .gallery-content p {
      color: #666;
      font-size: 1.2rem;
      line-height: 1.6;
    }
  </style>
</head>
<body>

  <!-- Countdown Heart Animation -->
  <canvas id="pinkboard"></canvas>

  <!-- Main Birthday Content -->
  <div id="main-content">
    <canvas id="heart"></canvas>

    <!-- Audio element - Replace "iris.mp3" with your downloaded file -->
    <audio id="bg-music" loop preload="auto">
      <source src="https://github.com/meshal997-coder/HBDShosho/blob/main/iris.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>
    
    <button id="toggle-music" title="Click to play music">
      ðŸ”‡
    </button>

    <div class="music-notification" id="music-notification">
      Click anywhere to play music
    </div>

    <div class="wrap">
      <div class="type-wrap">
        <span id="typed" style="white-space:pre-wrap;"></span>
      </div>
    </div>
  </div>
  
  <!-- Image Slideshow -->
  <div id="slideshow" class="slideshow">
    <img src="https://images.unsplash.com/photo-1494790108755-2616c113a1c1?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Image 1" class="active">
    <img src="https://images.unsplash.com/photo-1530789253388-582c481c54b0?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Image 2">
    <img src="https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Image 3">
    <img src="https://images.unsplash.com/photo-1542037104857-ffbb0b9155fb?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Image 4">
  </div>

  <!-- Image Gallery with Swan Background -->
  <div id="gallery" class="gallery swan-background">
    <div class="gallery-content">
      <h2>Our Beautiful Memories</h2>
      <p>Every moment with you is a treasure I'll cherish forever ðŸ’–</p>
      
      <div class="gallery-grid">
        <img src="https://images.unsplash.com/photo-1494790108755-2616c113a1c1?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Image 1">
        <img src="https://images.unsplash.com/photo-1530789253388-582c481c54b0?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Image 2">
        <img src="https://images.unsplash.com/photo-1511795409834-ef04bbd61622?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Image 3">
        <img src="https://images.unsplash.com/photo-1542037104857-ffbb0b9155fb?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" alt="Image 4">
      </div>

      <div style="width: 100%; text-align: center; margin-top: 2rem;">
        <a href="cake.html" class="next-button">Come on, let's make a wish together.</a>
      </div>
    </div>
  </div>

  <script>
    // Set the birthday date to PAST so it shows content immediately
    const birthday = new Date("2024-01-01T00:00:00");
    const now = new Date();
    const isPast = now >= birthday;

    // Music management
    let musicInitialized = false;

    function initializeMusic() {
      if (musicInitialized) return;
      
      const music = document.getElementById('bg-music');
      const toggleBtn = document.getElementById('toggle-music');
      const notification = document.getElementById('music-notification');

      // Show notification on first load
      setTimeout(() => {
        notification.classList.add('show');
        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      }, 1000);

      // Enable audio on first user interaction
      function enableAudio() {
        if (music.paused) {
          music.volume = 0.7;
          music.play().then(() => {
            toggleBtn.textContent = 'ðŸ”Š';
            musicInitialized = true;
          }).catch(e => {
            console.log('Audio play failed:', e);
            toggleBtn.textContent = 'ðŸ”‡';
            notification.textContent = 'Click to enable music';
            notification.classList.add('show');
            setTimeout(() => {
              notification.classList.remove('show');
            }, 2000);
          });
        }
        document.body.removeEventListener('click', enableAudio);
        document.body.removeEventListener('touchstart', enableAudio);
      }

      // Add event listeners for user interaction
      document.body.addEventListener('click', enableAudio);
      document.body.addEventListener('touchstart', enableAudio);

      // Toggle button functionality
      toggleBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (music.paused) {
          music.play().then(() => {
            toggleBtn.textContent = 'ðŸ”Š';
          }).catch(e => {
            notification.textContent = 'Click anywhere first';
            notification.classList.add('show');
            setTimeout(() => {
              notification.classList.remove('show');
            }, 2000);
          });
        } else {
          music.pause();
          toggleBtn.textContent = 'ðŸ”‡';
        }
      });

      musicInitialized = true;
    }

    // Initialize the page
    window.addEventListener('DOMContentLoaded', () => {
      console.log('Page loaded - initializing...');
      
      // Initialize music system
      initializeMusic();

      // Always show content (since birthday is in past)
      document.getElementById('pinkboard').style.display = 'none';
      document.getElementById('main-content').classList.add('show');
      
      // Start the typing sequence
      setTimeout(() => {
        startTypingSequence();
      }, 1000);
    });

    // Heart background animation
    function initHeartBackground() {
      const canvas = document.getElementById("heart");
      if (!canvas) return;

      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const heartPosition = rad => [
        Math.pow(Math.sin(rad), 3),
        -(15 * Math.cos(rad) - 5 * Math.cos(2 * rad) - 2 * Math.cos(3 * rad) - Math.cos(4 * rad))
      ];
      const scaleAndTranslate = (pos, sx, sy, dx, dy) => [dx + pos[0] * sx, dy + pos[1] * sy];

      const rand = Math.random;
      const traceCount = 50;
      let pointsOrigin = [], targetPoints = [], e = [];
      let time = 0;

      for (let i = 0; i < Math.PI * 2; i += 0.1) {
        pointsOrigin.push(scaleAndTranslate(heartPosition(i), 210, 13, 0, 0));
        pointsOrigin.push(scaleAndTranslate(heartPosition(i), 150, 9, 0, 0));
        pointsOrigin.push(scaleAndTranslate(heartPosition(i), 90, 5, 0, 0));
      }

      let heartPointsCount = pointsOrigin.length;

      const pulse = (kx, ky) => {
        for (let i = 0; i < pointsOrigin.length; i++) {
          targetPoints[i] = [
            kx * pointsOrigin[i][0] + canvas.width / 2,
            ky * pointsOrigin[i][1] + canvas.height / 2
          ];
        }
      };

      for (let i = 0; i < heartPointsCount; i++) {
        let x = rand() * canvas.width, y = rand() * canvas.height;
        e[i] = {
          vx: 0, vy: 0, R: 2,
          speed: rand() + 5,
          q: ~~(rand() * heartPointsCount),
          D: 2 * (i % 2) - 1,
          force: 0.2 * rand() + 0.7,
          f: `hsla(330, ${~~(40 * rand() + 60)}%, ${~~(60 * rand() + 20)}%, .3)`,
          trace: Array.from({ length: traceCount }, () => ({ x, y }))
        };
      }

      const loop = () => {
        let n = -Math.cos(time);
        pulse((1 + n) * 0.5, (1 + n) * 0.5);
        time += ((Math.sin(time)) < 0 ? 9 : (n > 0.8) ? 0.2 : 1) * 0.01;
        ctx.fillStyle = "rgba(0,0,0,.1)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (let u of e) {
          let q = targetPoints[u.q];
          let dx = u.trace[0].x - q[0];
          let dy = u.trace[0].y - q[1];
          let length = Math.sqrt(dx * dx + dy * dy);
          if (length < 10) {
            if (rand() > 0.95) u.q = ~~(rand() * heartPointsCount);
            else {
              if (rand() > 0.99) u.D *= -1;
              u.q = (u.q + u.D + heartPointsCount) % heartPointsCount;
            }
          }
          u.vx += -dx / length * u.speed;
          u.vy += -dy / length * u.speed;
          u.trace[0].x += u.vx;
          u.trace[0].y += u.vy;
          u.vx *= u.force;
          u.vy *= u.force;
          for (let k = 0; k < u.trace.length - 1; k++) {
            let T = u.trace[k], N = u.trace[k + 1];
            N.x -= 0.4 * (N.x - T.x);
            N.y -= 0.4 * (N.y - T.y);
          }
          ctx.fillStyle = u.f;
          for (let k = 0; k < u.trace.length; k++) {
            ctx.fillRect(u.trace[k].x, u.trace[k].y, 1, 1);
          }
        }
        requestAnimationFrame(loop);
      };

      loop();
    }

    // Typing animation
    const lines = [
      "My Dearest Love,",
      "Happy Birthday to the most amazing person in my life!",
      "Every day with you feels like a beautiful dream...",
      "Your smile lights up my world,",
      "Your laughter is my favorite melody,",
      "And your love is my greatest treasure.",
      "Today is all about celebrating YOU,",
      "The incredible, beautiful, wonderful person you are.",
      "I am so grateful for every moment we share,",
      "For every memory we've created,",
      "And for every dream we'll build together.",
      "You make my life complete in ways I never imagined.",
      "On this special day,",
      "I wish you all the happiness in the world.",
      "I love you more than words can express! ðŸ’–"
    ];

    const output = document.getElementById("typed");
    
    async function typeLine(line, speed = 60) {
      return new Promise(resolve => {
        let i = 0;
        output.textContent = "";
        function type() {
          if (i < line.length) {
            output.textContent += line.charAt(i);
            i++;
            setTimeout(type, speed);
          } else {
            setTimeout(() => resolve(), 1000);
          }
        }
        type();
      });
    }

    async function deleteLine(speed = 30) {
      return new Promise(resolve => {
        let text = output.textContent;
        let i = text.length;
        function del() {
          if (i > 0) {
            output.textContent = text.substring(0, --i);
            setTimeout(del, speed);
          } else {
            resolve();
          }
        }
        del();
      });
    }

    async function startTypingSequence() {
      console.log('Starting typing sequence...');
      for (let i = 0; i < lines.length; i++) {
        await typeLine(lines[i]);

        if (i === lines.length - 1) {
          setTimeout(showSlideshow, 1500);
        } else {
          await deleteLine();
        }
      }
    }

    function showSlideshow() {
      console.log('Showing slideshow...');
      const slideshow = document.getElementById('slideshow');
      const gallery = document.getElementById('gallery');
      if (!slideshow || !gallery) return;

      slideshow.style.display = 'flex';
      initHeartBackground();

      const images = slideshow.querySelectorAll('img');
      let index = 0;

      function nextImage() {
        images[index].classList.remove('active');
        index++;

        if (index < images.length) {
          images[index].classList.add('active');
        } else {
          setTimeout(() => {
            slideshow.style.display = 'none';
            gallery.style.display = 'flex';
          }, 1000);
          clearInterval(slideshowInterval);
        }
      }

      const slideshowInterval = setInterval(nextImage, 3000);
    }

    // Initialize heart background when main content is shown
    const observer = new MutationObserver((mutationsList) => {
      for (const mutation of mutationsList) {
        if (mutation.attributeName === 'class') {
          const target = mutation.target;
          if (target.classList.contains('show')) {
            initHeartBackground();
          }
        }
      }
    });

    const mainContent = document.getElementById('main-content');
    if (mainContent) {
      observer.observe(mainContent, { attributes: true });
    }
  </script>
</body>
</html>
